{"id":"components/BuilderBlock.vue","dependencies":[{"name":"/Users/tim/Dropbox/Server/htdocs/sandbox/kirby-nightly/site/plugins/kirby-builder/.babelrc","includedInParent":true,"mtime":1537474488486},{"name":"/Users/tim/Dropbox/Server/htdocs/sandbox/kirby-nightly/site/plugins/kirby-builder/package.json","includedInParent":true,"mtime":1543244669900},{"name":"_css_loader","parent":"/Users/tim/Dropbox/Server/htdocs/sandbox/kirby-nightly/site/plugins/kirby-builder/src/components/BuilderBlock.vue","resolved":"/Users/tim/Dropbox/Server/htdocs/sandbox/kirby-nightly/site/plugins/kirby-builder/node_modules/parcel-bundler/lib/builtins/css-loader.js"},{"name":"vue-hot-reload-api","parent":"/Users/tim/Dropbox/Server/htdocs/sandbox/kirby-nightly/site/plugins/kirby-builder/src/components/BuilderBlock.vue","resolved":"/Users/tim/Dropbox/Server/htdocs/sandbox/kirby-nightly/site/plugins/kirby-builder/node_modules/vue-hot-reload-api/dist/index.js"},{"name":"vue","parent":"/Users/tim/Dropbox/Server/htdocs/sandbox/kirby-nightly/site/plugins/kirby-builder/src/components/BuilderBlock.vue","resolved":"/Users/tim/Dropbox/Server/htdocs/sandbox/kirby-nightly/site/plugins/kirby-builder/node_modules/vue/dist/vue.runtime.esm.js"}],"generated":{"js":"\"use strict\";\n\nObject.defineProperty(exports, \"__esModule\", {\n  value: true\n});\nexports.default = void 0;\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\nvar _default = {\n  props: ['block', 'index', 'columnsCount', 'pageUid', 'pageId'],\n  mounted: function mounted() {\n    if (this.block.isNew) {\n      this.$nextTick(function () {\n        this.pending = false;\n      });\n    } else {\n      this.pending = false;\n    }\n\n    if (!this.block.content._uid) {\n      this.block.content._uid = this.block.content._key + '_' + new Date().valueOf() + '_' + this._uid;\n    }\n\n    if (!this.activeFieldSet) {\n      this.activeFieldSet = this.fieldSets[0].key;\n    }\n\n    var localUiState = JSON.parse(localStorage.getItem(this.localUiStateKey));\n\n    if (localUiState) {\n      this.expanded = localUiState.expanded;\n      this.showPreview = localUiState.showPreview;\n      this.activeFieldSet = localUiState.activeFieldSet;\n    } else {\n      this.storeLocalUiState();\n    }\n\n    if (this.block.preview && this.showPreview) {\n      this.displayPreview(this.block.preview);\n    } else {\n      this.displayFieldSet(this.activeFieldSet);\n    }\n\n    if (this.block.isNew) {\n      this.$emit('input');\n    }\n  },\n  data: function data() {\n    return {\n      pending: true,\n      activeFieldSet: null,\n      expanded: true,\n      previewFrameContent: null,\n      previewHeight: 0,\n      previewStored: false,\n      showPreview: false\n    };\n  },\n  computed: {\n    localUiStateKey: function localUiStateKey() {\n      return \"kBuilder.uiState.\".concat(this.block.content._uid);\n    },\n    extendedUid: function extendedUid() {\n      return 'dola'; // return this.pageId.replace('/', '-') + '-' + this._uid\n    },\n    previewUrl: function previewUrl() {\n      if (this.previewStored) {\n        return 'kirby-builder-preview/' + this.extendedUid + '?' + this.objectToGetParams(this.block.preview) + '&pageid=' + this.pageId;\n      } else {\n        return null;\n      }\n    },\n    fieldSets: function fieldSets() {\n      var fieldSets = [];\n\n      if (this.block.tabs) {\n        for (var tabKey in this.block.tabs) {\n          if (this.block.tabs.hasOwnProperty(tabKey)) {\n            var tab = this.block.tabs[tabKey];\n            fieldSets.push(this.newFieldSet(tab, tabKey, this.block.content));\n          }\n        }\n      } else if (this.block.fields) {\n        fieldSets.push(this.newFieldSet(this.block, 'content', this.block.content, 'edit', this.$t('edit')));\n      }\n\n      return fieldSets;\n    }\n  },\n  methods: {\n    onBlockInput: function onBlockInput(event) {\n      this.$emit(\"input\", this.val);\n    },\n    displayPreview: function displayPreview() {\n      var _this = this;\n\n      this.showPreview = true;\n      this.expanded = true;\n      var previewData = {\n        preview: this.block.preview,\n        blockcontent: this.block.content,\n        blockUid: this.extendedUid\n      };\n      this.$api.post('kirby-builder/preview', previewData).then(function () {\n        _this.previewStored = true;\n      });\n      this.storeLocalUiState();\n    },\n    displayFieldSet: function displayFieldSet(fieldSetKey) {\n      this.showPreview = false;\n      this.activeFieldSet = fieldSetKey;\n      this.previewHeight = 0;\n      this.storeLocalUiState();\n    },\n    onPreviewLoaded: function onPreviewLoaded(event) {\n      this.previewHeight = event.detail.height;\n      this.activeFieldSet = null;\n    },\n    toggleExpand: function toggleExpand(expanded) {\n      if (typeof expanded === 'boolean') {\n        this.expanded = expanded;\n      } else {\n        this.expanded = this.expanded ? false : true;\n      }\n\n      this.storeLocalUiState();\n    },\n    newFieldSet: function newFieldSet(fieldSet, key, model, icon, label) {\n      var newFieldSet = {\n        fields: fieldSet.fields,\n        key: key,\n        model: model,\n        icon: icon || fieldSet.icon || null,\n        label: label || fieldSet.label || null\n      };\n      return newFieldSet;\n    },\n    objectToGetParams: function objectToGetParams(obj) {\n      return Object.keys(obj).map(function (key) {\n        return key + '=' + obj[key];\n      }).join('&');\n    },\n    storeLocalUiState: function storeLocalUiState() {\n      var localUiState = {\n        expanded: this.expanded,\n        showPreview: this.showPreview,\n        activeFieldSet: this.activeFieldSet\n      };\n      localStorage.setItem(this.localUiStateKey, JSON.stringify(localUiState));\n    },\n    tabIcon: function tabIcon(icon) {\n      if (!icon) {\n        return null;\n      }\n\n      var isPath = icon.indexOf('/') > -1 && icon.indexOf('.') > -1;\n      return isPath ? null : icon;\n    },\n    tabImage: function tabImage(icon) {\n      if (!icon) {\n        return null;\n      }\n\n      var isPath = icon.indexOf('/') > -1 && icon.indexOf('.') > -1;\n      return isPath ? icon : null;\n    }\n  }\n};\nexports.default = _default;\n        var $0bc70d = exports.default || module.exports;\n      \n      if (typeof $0bc70d === 'function') {\n        $0bc70d = $0bc70d.options;\n      }\n    \n        /* template */\n        Object.assign($0bc70d, (function () {\n          var render = function() {\n  var _vm = this\n  var _h = _vm.$createElement\n  var _c = _vm._self._c || _h\n  return _c(\n    \"div\",\n    {\n      class: [\n        \"kBuilderBlock\",\n        \"kBuilderBlock--col-\" + _vm.columnsCount,\n        { \"kBuilderBlock--pending\": _vm.pending }\n      ]\n    },\n    [\n      _c(\n        \"div\",\n        {\n          class:\n            \"kBuilderBlock__header kBuilderBlock__header--col-\" +\n            _vm.columnsCount\n        },\n        [\n          _c(\"k-icon\", {\n            class:\n              \"kBuilder__dragDropHandle kBuilder__dragDropHandle--col-\" +\n              _vm.columnsCount,\n            attrs: { type: \"sort\" }\n          }),\n          _vm._v(\" \"),\n          _c(\n            \"span\",\n            {\n              staticClass: \"kBuilderBlock__label\",\n              on: { click: _vm.toggleExpand }\n            },\n            [\n              _c(\"k-icon\", {\n                staticClass: \"kBuilderBlock__expandedIcon\",\n                class: {\n                  \"kBuilderBlock__expandedIcon--expanded\": _vm.expanded\n                },\n                attrs: { type: \"angle-down\" }\n              }),\n              _vm._v(\"\\n      \" + _vm._s(_vm.block.label) + \"\\n    \")\n            ],\n            1\n          ),\n          _vm._v(\" \"),\n          _c(\n            \"div\",\n            { staticClass: \"kBuilderBlock__actions\" },\n            [\n              _c(\n                \"k-button-group\",\n                { staticClass: \"kBuilderBlock__actionsGroup\" },\n                [\n                  _vm._l(_vm.fieldSets, function(fieldSet) {\n                    return _vm.fieldSets.length > 1 || _vm.block.preview\n                      ? _c(\n                          \"k-button\",\n                          {\n                            key:\n                              \"showFierldSetButton-\" + _vm._uid + fieldSet.key,\n                            staticClass: \"kBuilderBlock__actionsButton\",\n                            class: {\n                              \"kBuilderBlock__actionsButton--active\":\n                                _vm.activeFieldSet == fieldSet.key &&\n                                _vm.expanded\n                            },\n                            attrs: {\n                              icon: _vm.tabIcon(fieldSet.icon),\n                              image: _vm.tabImage(fieldSet.icon)\n                            },\n                            on: {\n                              click: function($event) {\n                                _vm.displayFieldSet(fieldSet.key)\n                                _vm.toggleExpand(true)\n                              }\n                            }\n                          },\n                          [_vm._v(_vm._s(fieldSet.label))]\n                        )\n                      : _vm._e()\n                  }),\n                  _vm._v(\" \"),\n                  _vm.block.preview\n                    ? _c(\"k-button\", {\n                        staticClass: \"kBuilderBlock__actionsButton\",\n                        class: {\n                          \"kBuilderBlock__actionsButton--active\":\n                            _vm.showPreview && _vm.expanded\n                        },\n                        attrs: { icon: \"preview\" },\n                        on: {\n                          click: function($event) {\n                            _vm.displayPreview()\n                          }\n                        }\n                      })\n                    : _vm._e()\n                ],\n                2\n              ),\n              _vm._v(\" \"),\n              _c(\n                \"div\",\n                { staticClass: \"kBuilderBlock__control\" },\n                [\n                  _c(\n                    \"k-dropdown\",\n                    { staticClass: \"kBuilderBlock__actionsDropDown\" },\n                    [\n                      _c(\"k-button\", {\n                        staticClass: \"kBuilderBlock__actionsButton\",\n                        attrs: { icon: \"dots\" },\n                        on: {\n                          click: function($event) {\n                            _vm.$refs[\n                              \"blockActions\" + _vm.block.uniqueKey\n                            ].toggle()\n                          }\n                        }\n                      }),\n                      _vm._v(\" \"),\n                      _c(\n                        \"k-dropdown-content\",\n                        { ref: \"blockActions\" + _vm.block.uniqueKey },\n                        [\n                          _c(\n                            \"k-dropdown-item\",\n                            {\n                              attrs: { icon: \"copy\" },\n                              on: {\n                                click: function($event) {\n                                  _vm.$emit(\"clone\", _vm.index)\n                                }\n                              }\n                            },\n                            [_vm._v(_vm._s(_vm.$t(\"builder.clone\")))]\n                          ),\n                          _vm._v(\" \"),\n                          _c(\n                            \"k-dropdown-item\",\n                            {\n                              attrs: { icon: \"trash\" },\n                              on: {\n                                click: function($event) {\n                                  _vm.$emit(\"delete\", _vm.index)\n                                }\n                              }\n                            },\n                            [_vm._v(_vm._s(_vm.$t(\"delete\")))]\n                          )\n                        ],\n                        1\n                      )\n                    ],\n                    1\n                  )\n                ],\n                1\n              )\n            ],\n            1\n          )\n        ],\n        1\n      ),\n      _vm._v(\" \"),\n      _c(\n        \"div\",\n        {\n          directives: [\n            {\n              name: \"show\",\n              rawName: \"v-show\",\n              value: _vm.expanded,\n              expression: \"expanded\"\n            }\n          ],\n          staticClass: \"kBuilderBlock__content\"\n        },\n        [\n          _vm.block.preview && _vm.showPreview && _vm.previewUrl\n            ? _c(\"iframe\", {\n                staticClass: \"kBuilder__previewFrame\",\n                style: { height: _vm.previewHeight + \"px\" },\n                attrs: { src: _vm.previewUrl },\n                on: { loaded: _vm.onPreviewLoaded }\n              })\n            : _vm._e(),\n          _vm._v(\" \"),\n          _vm._l(_vm.fieldSets, function(fieldSet) {\n            return _vm.activeFieldSet === fieldSet.key\n              ? _c(\n                  \"k-fieldset\",\n                  _vm._g(\n                    {\n                      key: fieldSet.key + _vm._uid,\n                      staticClass: \"kBuilderBlock__form\",\n                      attrs: {\n                        value: {},\n                        fields: fieldSet.fields,\n                        validate: true\n                      },\n                      model: {\n                        value: fieldSet.model,\n                        callback: function($$v) {\n                          _vm.$set(fieldSet, \"model\", $$v)\n                        },\n                        expression: \"fieldSet.model\"\n                      }\n                    },\n                    _vm.$listeners\n                  )\n                )\n              : _vm._e()\n          })\n        ],\n        2\n      )\n    ]\n  )\n}\nvar staticRenderFns = []\nrender._withStripped = true\n\n          return {\n            render: render,\n            staticRenderFns: staticRenderFns,\n            _compiled: true,\n            _scopeId: null,\n            functional: undefined\n          };\n        })());\n      \n    /* hot reload */\n    (function () {\n      if (module.hot) {\n        var api = require('vue-hot-reload-api');\n        api.install(require('vue'));\n        if (api.compatible) {\n          module.hot.accept();\n          if (!module.hot.data) {\n            api.createRecord('$0bc70d', $0bc70d);\n          } else {\n            api.reload('$0bc70d', $0bc70d);\n          }\n        }\n\n        \n        var reloadCSS = require('_css_loader');\n        module.hot.dispose(reloadCSS);\n        module.hot.accept(reloadCSS);\n      \n      }\n    })();","css":".kBuilderBlock {\n  background: #fff;\n  box-shadow: 0 2px 5px rgba(22,23,26,0.05);\n  position: relative;\n  opacity: 1;\n  transition: opacity 0.5s, transform 0.5s;\n}\n.kBuilderBlock--pending {\n  opacity: 0;\n  transform: translateY(5%);\n}\n.kBuilderBlock__label {\n  display: -ms-flexbox;\n  display: flex;\n  cursor: pointer;\n  height: 100%;\n  -ms-flex-align: center;\n      align-items: center;\n}\n.kBuilderBlock__expandedIcon {\n  margin-right: 4px;\n  transform: rotate(-90deg);\n}\n.kBuilderBlock__expandedIcon--expanded {\n  transform: rotate(0);\n}\n.kBuilderBlock__header {\n  height: 38px;\n  font-size: 0.875rem;\n  display: -ms-flexbox;\n  display: flex;\n  -ms-flex-align: center;\n      align-items: center;\n}\n.kBuilderBlock__header--col-1 {\n  padding-left: 0.75rem;\n}\n.kBuilderBlock__actions {\n  position: absolute;\n  right: 0;\n  top: 0;\n  display: -ms-flexbox;\n  display: flex;\n}\n.kBuilderBlock__actionsGroup {\n  margin-right: 0;\n}\n.kBuilderBlock__actionsGroup.k-button-group>.k-button {\n  padding-top: 0;\n  padding-bottom: 0;\n}\n.kBuilderBlock__actionsDropDown {\n  display: inline-block;\n}\n.kBuilderBlock__actionsButton {\n  min-width: 38px;\n  height: 38px;\n  opacity: 0.5;\n  color: #16171a;\n}\n.kBuilderBlock__actionsButton:hover {\n  opacity: 0.7;\n}\n.kBuilderBlock__actionsButton--active {\n  pointer-events: none;\n  opacity: 1;\n}\n.kBuilderBlock__actionsButton .k-button-figure img {\n  background-color: transparent;\n  border-radius: 0;\n}\n.kBuilderBlock__form {\n  padding: 0.625rem 0.75rem 2.25rem 0.75rem;\n}\n.kBuilderBlock .sortable-drag {\n  cursor: -webkit-grab;\n}\n.kBuilderBlock,\n.kBuilderBlock .kBuilderBlock,\n.kBuilderBlock .k-structure,\n.kBuilderBlock .k-card,\n.kBuilderBlock .k-list-item {\n  box-shadow: 0 2px 5px rgba(22,23,26,0.15), 0 0 0 1px rgba(22,23,26,0.05);\n}\n.kBuilderBlock .k-structure {\n  margin-left: 25px;\n}\n.sortable-ghost > .k-column-content > .kBuilderBlock,\n.sortable-ghost > .kBuilderBlock {\n  box-shadow: 0 0 0 2px #4271ae, 0 5px 10px 2px rgba(22,23,26,0.25);\n}\n"},"hash":"66ef8f3fa095ad2cce068336cbfa018e","cacheData":{"env":{}}}