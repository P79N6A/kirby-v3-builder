{"id":"kT3a","dependencies":[{"name":"/Users/tim/Dropbox/Server/htdocs/sandbox/kirby-nightly/site/plugins/kirby-builder/.babelrc","includedInParent":true,"mtime":1537474488486},{"name":"/Users/tim/Dropbox/Server/htdocs/sandbox/kirby-nightly/site/plugins/kirby-builder/package.json","includedInParent":true,"mtime":1543244669900}],"generated":{"js":"var $kT3a$exports={},$kT3a$export$default={props:[\"block\",\"index\",\"columnsCount\",\"pageUid\",\"pageId\"],mounted:function(){this.block.isNew?this.$nextTick(function(){this.pending=!1}):this.pending=!1,this.block.content._uid||(this.block.content._uid=this.block.content._key+\"_\"+(new Date).valueOf()+\"_\"+this._uid),this.activeFieldSet||(this.activeFieldSet=this.fieldSets[0].key);var e=JSON.parse(localStorage.getItem(this.localUiStateKey));e?(this.expanded=e.expanded,this.showPreview=e.showPreview,this.activeFieldSet=e.activeFieldSet):this.storeLocalUiState(),this.block.preview&&this.showPreview?this.displayPreview(this.block.preview):this.displayFieldSet(this.activeFieldSet),this.block.isNew&&this.$emit(\"input\")},data:function(){return{pending:!0,activeFieldSet:null,expanded:!0,previewFrameContent:null,previewHeight:0,previewStored:!1,showPreview:!1}},computed:{localUiStateKey:function(){return\"kBuilder.uiState.\".concat(this.block.content._uid)},extendedUid:function(){return\"dola\"},previewUrl:function(){return this.previewStored?\"kirby-builder-preview/\"+this.extendedUid+\"?\"+this.objectToGetParams(this.block.preview)+\"&pageid=\"+this.pageId:null},fieldSets:function(){var e=[];if(this.block.tabs){for(var t in this.block.tabs)if(this.block.tabs.hasOwnProperty(t)){var i=this.block.tabs[t];e.push(this.newFieldSet(i,t,this.block.content))}}else this.block.fields&&e.push(this.newFieldSet(this.block,\"content\",this.block.content,\"edit\",this.$t(\"edit\")));return e}},methods:{onBlockInput:function(e){this.$emit(\"input\",this.val)},displayPreview:function(){var e=this;this.showPreview=!0,this.expanded=!0;var t={preview:this.block.preview,blockcontent:this.block.content,blockUid:this.extendedUid};this.$api.post(\"kirby-builder/preview\",t).then(function(){e.previewStored=!0}),this.storeLocalUiState()},displayFieldSet:function(e){this.showPreview=!1,this.activeFieldSet=e,this.previewHeight=0,this.storeLocalUiState()},onPreviewLoaded:function(e){this.previewHeight=e.detail.height,this.activeFieldSet=null},toggleExpand:function(e){this.expanded=\"boolean\"==typeof e?e:!this.expanded,this.storeLocalUiState()},newFieldSet:function(e,t,i,n,o){var s={fields:e.fields,key:t,model:i,icon:n||e.icon||null,label:o||e.label||null};return s},objectToGetParams:function(e){return Object.keys(e).map(function(t){return t+\"=\"+e[t]}).join(\"&\")},storeLocalUiState:function(){var e={expanded:this.expanded,showPreview:this.showPreview,activeFieldSet:this.activeFieldSet};localStorage.setItem(this.localUiStateKey,JSON.stringify(e))},tabIcon:function(e){return e?e.indexOf(\"/\")>-1&&e.indexOf(\".\")>-1?null:e:null},tabImage:function(e){return e&&e.indexOf(\"/\")>-1&&e.indexOf(\".\")>-1?e:null}}};$kT3a$exports.default=$kT3a$export$default;\n      if (typeof $kT3a$export$default === 'function') {\n        $kT3a$export$default = $kT3a$export$default.options;\n      }\n    \n        /* template */\n        Object.assign($kT3a$export$default, (function () {\n          var render = function () {var _vm=this;var _h=_vm.$createElement;var _c=_vm._self._c||_h;return _c('div',{class:['kBuilderBlock', 'kBuilderBlock--col-' + _vm.columnsCount, {'kBuilderBlock--pending': _vm.pending }]},[_c('div',{class:'kBuilderBlock__header kBuilderBlock__header--col-' + _vm.columnsCount},[_c('k-icon',{class:'kBuilder__dragDropHandle kBuilder__dragDropHandle--col-' + _vm.columnsCount,attrs:{\"type\":\"sort\"}}),_vm._v(\" \"),_c('span',{staticClass:\"kBuilderBlock__label\",on:{\"click\":_vm.toggleExpand}},[_c('k-icon',{staticClass:\"kBuilderBlock__expandedIcon\",class:{'kBuilderBlock__expandedIcon--expanded': _vm.expanded},attrs:{\"type\":\"angle-down\"}}),_vm._v(\" \"+_vm._s(_vm.block.label)+\" \")],1),_vm._v(\" \"),_c('div',{staticClass:\"kBuilderBlock__actions\"},[_c('k-button-group',{staticClass:\"kBuilderBlock__actionsGroup\"},[_vm._l((_vm.fieldSets),function(fieldSet){return (_vm.fieldSets.length > 1 || _vm.block.preview)?_c('k-button',{key:'showFierldSetButton-' + _vm._uid + fieldSet.key,staticClass:\"kBuilderBlock__actionsButton\",class:{'kBuilderBlock__actionsButton--active': (_vm.activeFieldSet == fieldSet.key && _vm.expanded )},attrs:{\"icon\":_vm.tabIcon(fieldSet.icon),\"image\":_vm.tabImage(fieldSet.icon)},on:{\"click\":function($event){_vm.displayFieldSet(fieldSet.key); _vm.toggleExpand(true)}}},[_vm._v(_vm._s(fieldSet.label))]):_vm._e()}),_vm._v(\" \"),(_vm.block.preview)?_c('k-button',{staticClass:\"kBuilderBlock__actionsButton\",class:{'kBuilderBlock__actionsButton--active': _vm.showPreview && _vm.expanded},attrs:{\"icon\":\"preview\"},on:{\"click\":function($event){_vm.displayPreview()}}}):_vm._e()],2),_vm._v(\" \"),_c('div',{staticClass:\"kBuilderBlock__control\"},[_c('k-dropdown',{staticClass:\"kBuilderBlock__actionsDropDown\"},[_c('k-button',{staticClass:\"kBuilderBlock__actionsButton\",attrs:{\"icon\":\"dots\"},on:{\"click\":function($event){_vm.$refs['blockActions' + _vm.block.uniqueKey].toggle()}}}),_vm._v(\" \"),_c('k-dropdown-content',{ref:'blockActions' + _vm.block.uniqueKey},[_c('k-dropdown-item',{attrs:{\"icon\":\"copy\"},on:{\"click\":function($event){_vm.$emit('clone', _vm.index)}}},[_vm._v(_vm._s(_vm.$t('builder.clone')))]),_vm._v(\" \"),_c('k-dropdown-item',{attrs:{\"icon\":\"trash\"},on:{\"click\":function($event){_vm.$emit('delete', _vm.index)}}},[_vm._v(_vm._s(_vm.$t('delete')))])],1)],1)],1)],1)],1),_vm._v(\" \"),_c('div',{directives:[{name:\"show\",rawName:\"v-show\",value:(_vm.expanded),expression:\"expanded\"}],staticClass:\"kBuilderBlock__content\"},[(_vm.block.preview && _vm.showPreview && _vm.previewUrl)?_c('iframe',{staticClass:\"kBuilder__previewFrame\",style:({height: _vm.previewHeight + 'px'}),attrs:{\"src\":_vm.previewUrl},on:{\"loaded\":_vm.onPreviewLoaded}}):_vm._e(),_vm._v(\" \"),_vm._l((_vm.fieldSets),function(fieldSet){return ((_vm.activeFieldSet === fieldSet.key))?_c('k-fieldset',_vm._g({key:fieldSet.key + _vm._uid,staticClass:\"kBuilderBlock__form\",attrs:{\"value\":{},\"fields\":fieldSet.fields,\"validate\":true},model:{value:(fieldSet.model),callback:function ($$v) {_vm.$set(fieldSet, \"model\", $$v)},expression:\"fieldSet.model\"}},_vm.$listeners)):_vm._e()})],2)])}\nvar staticRenderFns = []\n\n          return {\n            render: render,\n            staticRenderFns: staticRenderFns,\n            _compiled: true,\n            _scopeId: null,\n            functional: undefined\n          };\n        })());\n      ","css":".kBuilderBlock{background:#fff;box-shadow:0 2px 5px rgba(22,23,26,.05);position:relative;opacity:1;transition:opacity .5s,transform .5s}.kBuilderBlock--pending{opacity:0;transform:translateY(5%)}.kBuilderBlock__label{display:-ms-flexbox;display:flex;cursor:pointer;height:100%;-ms-flex-align:center;align-items:center}.kBuilderBlock__expandedIcon{margin-right:4px;transform:rotate(-90deg)}.kBuilderBlock__expandedIcon--expanded{transform:rotate(0)}.kBuilderBlock__header{height:38px;font-size:.875rem;display:-ms-flexbox;display:flex;-ms-flex-align:center;align-items:center}.kBuilderBlock__header--col-1{padding-left:.75rem}.kBuilderBlock__actions{position:absolute;right:0;top:0;display:-ms-flexbox;display:flex}.kBuilderBlock__actionsGroup{margin-right:0}.kBuilderBlock__actionsGroup.k-button-group>.k-button{padding-top:0;padding-bottom:0}.kBuilderBlock__actionsDropDown{display:inline-block}.kBuilderBlock__actionsButton{min-width:38px;height:38px;opacity:.5;color:#16171a}.kBuilderBlock__actionsButton:hover{opacity:.7}.kBuilderBlock__actionsButton--active{pointer-events:none;opacity:1}.kBuilderBlock__actionsButton .k-button-figure img{background-color:transparent;border-radius:0}.kBuilderBlock__form{padding:.625rem .75rem 2.25rem}.kBuilderBlock .sortable-drag{cursor:-webkit-grab}.kBuilderBlock,.kBuilderBlock .k-card,.kBuilderBlock .k-list-item,.kBuilderBlock .k-structure,.kBuilderBlock .kBuilderBlock{box-shadow:0 2px 5px rgba(22,23,26,.15),0 0 0 1px rgba(22,23,26,.05)}.kBuilderBlock .k-structure{margin-left:25px}.sortable-ghost>.k-column-content>.kBuilderBlock,.sortable-ghost>.kBuilderBlock{box-shadow:0 0 0 2px #4271ae,0 5px 10px 2px rgba(22,23,26,.25)}"},"hash":"d78f2387554245456afa10822ea3625a","cacheData":{"env":{},"imports":{},"exports":{"default":"$kT3a$export$default"},"wildcards":[],"sideEffects":true,"isES6Module":true,"shouldWrap":false}}